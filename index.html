<!DOCTYPE html>
<html lang="th">
<head>
    <meta name="google-site-verification" content="4UuqTSUhnU_dtQ4EAtLoMiJzP6wj1sYb4Uprlx9TUuk" />

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Task School - ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô</title>
    <meta name="description" content="Task School ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô ‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏ú‡πà‡∏≤‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡πÅ‡∏•‡∏∞‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå">
    <meta name="keywords" content="Task School, ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô, ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô, ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô, ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏≠‡∏µ‡πÄ‡∏°‡∏•">
    <meta name="robots" content="index, follow">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap');
        :root { --primary-orange: #d97706; --bg-cream: #fffaf5; --accent-yellow: #f59e0b; --soft-border: #f3e8d2; }
        body { font-family: 'Sarabun', sans-serif; background-color: var(--bg-cream); color: #4b2c20; }
        .hidden { display: none; }
        .is-done { opacity: 0.6; filter: grayscale(40%); }
        .note-card { transition: all 0.3s ease; border: 1px solid var(--soft-border); background: #ffffff; position: relative; }
        .btn-tab { padding: 8px 20px; border-radius: 9999px; font-size: 0.875rem; font-weight: 700; transition: all 0.2s; border: 1px solid transparent; white-space: nowrap; }
        .btn-active { background-color: #fef3c7; color: #b45309; border-color: #fde68a; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .btn-inactive { background-color: #f3f4f6; color: #9ca3af; border-color: #e5e7eb; }
        
        /* Dropdown */
        .dropdown-content { display: none; position: absolute; right: 0; bottom: 100%; margin-bottom: 10px; background: white; border: 1px solid var(--soft-border); border-radius: 16px; z-index: 1000; box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 150px; overflow: hidden; }
        .dropdown:focus-within .dropdown-content { display: block; }
        
        /* Toast */
        #toast { visibility: hidden; min-width: 250px; background-color: #4b2c20; color: #fff; text-align: center; border-radius: 20px; padding: 16px; position: fixed; z-index: 2000; left: 50%; bottom: 30px; transform: translateX(-50%); }
        #toast.show { visibility: visible; animation: fadein 0.5s, fadeout 0.5s 2.5s; }
        @keyframes fadein { from {bottom: 0; opacity: 0;} to {bottom: 30px; opacity: 1;} }
        @keyframes fadeout { from {bottom: 30px; opacity: 1;} to {bottom: 0; opacity: 0;} }
    </style>
</head>
<body>

    <div id="toast">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</div>

    <div id="login-screen" class="flex items-center justify-center min-h-screen p-6">
        <div class="bg-white p-8 rounded-[2.5rem] shadow-2xl w-full max-w-sm border border-[#f3e8d2]">
            <div class="w-20 h-20 bg-[#fef3c7] rounded-full mx-auto mb-6 flex items-center justify-center text-4xl">üìö</div>
            <h1 class="text-3xl font-bold mb-2 text-[#d97706] text-center">Task School</h1>
            <p class="text-[#a39382] mb-8 text-sm font-medium text-center">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏á‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏á</p>
            <div class="space-y-4">
                <input type="text" id="nickname" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô" class="w-full p-4 border border-[#f3e8d2] rounded-2xl outline-none focus:ring-2 focus:ring-[#f59e0b] bg-[#fffcf8] px-6">
                <input type="email" id="email" placeholder="‡∏≠‡∏µ‡πÄ‡∏°‡∏•" class="w-full p-4 border border-[#f3e8d2] rounded-2xl outline-none focus:ring-2 focus:ring-[#f59e0b] bg-[#fffcf8] px-6">
                <button onclick="login()" class="w-full bg-[#d97706] text-white p-4 rounded-2xl font-bold shadow-lg hover:bg-[#b45309] transition-all transform active:scale-95">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</button>
            </div>
        </div>
    </div>

    <div id="dashboard" class="hidden min-h-screen pb-24">
        <nav class="bg-white/90 backdrop-blur-md p-5 border-b border-[#f3e8d2] sticky top-0 z-40">
            <div class="max-w-4xl mx-auto flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-[#d97706]">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡∏≠‡∏á <span id="user-name" class="text-[#4b2c20]"></span></h2>
                <button onclick="logout()" class="text-[#a39382] text-xs font-bold uppercase hover:text-red-500">Log out</button>
            </div>
            <div class="max-w-4xl mx-auto flex gap-2 overflow-x-auto pb-1">
                <button id="btn-all" onclick="changeView('all')" class="btn-tab btn-active">‡πÇ‡∏ô‡πâ‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
                <button id="btn-done" onclick="changeView('done')" class="btn-tab btn-inactive">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß ‚úÖ</button>
                <button id="btn-trash" onclick="changeView('trash')" class="btn-tab btn-inactive">‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞</button>
            </div>
        </nav>

        <div class="max-w-4xl mx-auto p-4">
            <div id="trash-info" class="hidden mb-4 p-4 bg-red-50 border border-red-100 rounded-2xl text-red-600 text-xs font-bold text-center">
                ‚ö†Ô∏è ‡πÇ‡∏ô‡πâ‡∏ï‡πÉ‡∏ô‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏ñ‡∏≤‡∏ß‡∏£‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏£‡∏ö 7 ‡∏ß‡∏±‡∏ô
            </div>
            <div id="note-list" class="flex flex-col gap-4"></div>
        </div>

        <button onclick="openModal()" class="fixed bottom-8 right-8 w-16 h-16 bg-[#f59e0b] text-white rounded-full text-4xl shadow-2xl flex items-center justify-center transition hover:scale-110 active:scale-95 border-4 border-white z-[110]">+</button>
    </div>

    <div id="modal" class="hidden fixed inset-0 bg-[#4b2c20]/40 flex items-center justify-center p-4 z-[2000] backdrop-blur-sm">
        <div class="bg-white w-full max-w-md p-8 rounded-[2.5rem] shadow-2xl">
            <h3 id="modal-title" class="text-2xl font-bold mb-6 text-[#4b2c20]">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h3>
            <input type="hidden" id="edit-id">
            <input type="text" id="title" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏¥‡∏ä‡∏≤ / ‡∏ä‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô" class="w-full p-4 mb-4 border border-[#f3e8d2] bg-[#fffcf8] rounded-2xl outline-none focus:ring-2 focus:ring-[#f59e0b] font-bold">
            <textarea id="content" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î..." class="w-full h-32 p-4 mb-4 border border-[#f3e8d2] bg-[#fffcf8] rounded-2xl outline-none focus:ring-2 focus:ring-[#f59e0b] resize-none"></textarea>
            <div class="grid grid-cols-2 gap-4 mb-8">
                <div>
                    <label class="block mb-2 text-xs font-bold text-[#a39382] ml-2 uppercase">Date</label>
                    <input type="date" id="date" class="w-full p-4 border border-[#f3e8d2] bg-[#fffcf8] rounded-2xl text-sm">
                </div>
                <div>
                    <label class="block mb-2 text-xs font-bold text-[#a39382] ml-2 uppercase">Time</label>
                    <input type="time" id="time" class="w-full p-4 border border-[#f3e8d2] bg-[#fffcf8] rounded-2xl text-sm">
                </div>
            </div>
            <div class="flex gap-4">
                <button onclick="closeModal()" class="flex-1 p-4 text-[#a39382] font-bold">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button onclick="saveNote()" class="flex-1 p-4 bg-[#d97706] text-white rounded-2xl font-bold shadow-lg">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <script>
        const _URL = 'https://vapsoypudgmcxpayrtug.supabase.co';
        const _KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZhcHNveXB1ZGdtY3hwYXlydHVnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkwNDMzOTUsImV4cCI6MjA4NDYxOTM5NX0.AnD5YcWiDifHVARsCejbyxyzs_yggjE3o43UHxeQ5GM';
        const supabaseClient = supabase.createClient(_URL, _KEY);

        let user = { name: '', email: '' };
        let currentView = 'all';
        let notifiedIDs = new Set();

        window.onload = () => {
            const savedUser = localStorage.getItem('task_school_user');
            if (savedUser) { user = JSON.parse(savedUser); showDashboard(); }
            
            if (Notification.permission !== "granted") {
                Notification.requestPermission();
            }
            setInterval(checkDueNotifications, 60000);
        };

        function login() {
            const name = document.getElementById('nickname').value;
            const email = document.getElementById('email').value;
            if(!name || !email) return alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
            user = { name, email };
            localStorage.setItem('task_school_user', JSON.stringify(user));
            showDashboard();
        }

        function showDashboard() {
            document.getElementById('user-name').innerText = user.name;
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('dashboard').classList.remove('hidden');
            fetchNotes();
        }

        function logout() { localStorage.removeItem('task_school_user'); location.reload(); }

        function changeView(view) {
            currentView = view;
            ['all', 'done', 'trash'].forEach(v => {
                document.getElementById(`btn-${v}`).className = (v === view) ? 'btn-tab btn-active' : 'btn-tab btn-inactive';
            });
            document.getElementById('trash-info').classList.toggle('hidden', view !== 'trash');
            if(view === 'trash') autoCleanTrash();
            fetchNotes();
        }

        async function fetchNotes() {
            let query = supabaseClient.from('note').select('*').eq('email', user.email);
            if (currentView === 'trash') query = query.eq('is_deleted', true);
            else if (currentView === 'done') query = query.eq('is_deleted', false).eq('is_done', true);
            else query = query.eq('is_deleted', false);

            const { data } = await query.order('is_pinned', { ascending: false })
                                       .order('is_done', { ascending: true })
                                       .order('due_date', { ascending: true });

            const list = document.getElementById('note-list');
            list.innerHTML = (data && data.length) ? '' : `<div class="text-center py-20 text-[#a39382] font-bold">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</div>`;
            
            if(data) data.forEach(n => {
                const dateObj = new Date(n.due_date);
                const timeStr = n.due_date.split('T')[1].substring(0,5);
                const displayDateTime = `${dateObj.getDate()}/${dateObj.getMonth()+1}/${dateObj.getFullYear()+543} | ${timeStr} ‡∏ô.`;

                list.innerHTML += `
                <div class="note-card p-6 rounded-[2rem] ${n.is_done ? 'is-done' : ''} ${n.is_pinned ? 'bg-[#fffbeb] border-[#fde68a]' : 'bg-white'}">
                    <div class="flex items-start gap-4">
                        <input type="checkbox" ${n.is_done ? 'checked' : ''} onchange="toggleDone(${n.id}, ${n.is_done})" class="mt-1.5 w-6 h-6 rounded-full accent-[#d97706] cursor-pointer">
                        <div class="flex-1">
                            <h4 class="font-bold text-lg text-[#4b2c20]">${n.title}</h4>
                            <p class="text-[#6b7280] text-sm mb-3">${n.content || ''}</p>
                            <span class="text-[11px] font-bold text-[#b45309] bg-[#fef3c7] px-3 py-1 rounded-full">üîî ${displayDateTime}</span>
                        </div>
                        <div class="dropdown relative">
                            <button class="p-2 text-gray-300 hover:text-[#d97706] text-xl">‚ãÆ</button>
                            <div class="dropdown-content">
                                ${currentView === 'trash' ? 
                                `<button onclick="restoreNote(${n.id})" class="w-full text-left p-3 text-sm font-bold text-[#d97706] hover:bg-orange-50">‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô</button>
                                 <button onclick="permanentDelete(${n.id})" class="w-full text-left p-3 text-sm font-bold text-red-500 hover:bg-red-50">‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£</button>` : 
                                `<button onclick="togglePin(${n.id}, ${n.is_pinned})" class="w-full text-left p-3 text-sm font-bold text-[#b45309] border-b border-orange-50 hover:bg-orange-50">${n.is_pinned ? '‡πÄ‡∏•‡∏¥‡∏Å‡∏´‡∏°‡∏∏‡∏î' : '‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î'}</button>
                                 <button onclick='editNote(${JSON.stringify(n)})' class="w-full text-left p-3 text-sm font-bold text-[#4b2c20] border-b border-orange-50 hover:bg-orange-50">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                                 <button onclick="moveToTrash(${n.id})" class="w-full text-left p-3 text-sm font-bold text-red-500 hover:bg-red-50">‡∏•‡∏ö‡∏≠‡∏≠‡∏Å</button>`}
                            </div>
                        </div>
                    </div>
                </div>`;
            });
        }

        async function checkDueNotifications() {
            const now = new Date();
            const { data } = await supabaseClient.from('note').select('*').eq('email', user.email).eq('is_deleted', false).eq('is_done', false);
            if(data) data.forEach(task => {
                const due = new Date(task.due_date);
                const diffMin = Math.floor((due - now) / 60000);
                if (diffMin === 0 && !notifiedIDs.has(task.id)) {
                    notifiedIDs.add(task.id);
                    if (Notification.permission === "granted") {
                        new Notification("üéì Task School: ‡∏ñ‡∏∂‡∏á‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô!", {
                            body: `‡∏ß‡∏¥‡∏ä‡∏≤: ${task.title}\n${task.content || ''}`,
                            icon: "https://cdn-icons-png.flaticon.com/512/2098/2098402.png"
                        });
                    }
                    alert(`‚è∞ ‡∏ñ‡∏∂‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô: ${task.title}`);
                }
            });
        }

        async function saveNote() {
            const id = document.getElementById('edit-id').value;
            const title = document.getElementById('title').value;
            const content = document.getElementById('content').value;
            const date = document.getElementById('date').value;
            const time = document.getElementById('time').value || "00:00";
            if(!title || !date) return alert('‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö');
            
            const payload = { 
                email: user.email, 
                name: user.name, 
                title: title, 
                content: content, 
                due_date: `${date}T${time}:00`, 
                is_deleted: false 
            };
            
            const res = id ? await supabaseClient.from('note').update(payload).eq('id', id) : await supabaseClient.from('note').insert([payload]);
            if(!res.error) { showToast("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!"); closeModal(); fetchNotes(); }
            else { alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ' + res.error.message); }
        }

        async function toggleDone(id, status) { await supabaseClient.from('note').update({ is_done: !status }).eq('id', id); fetchNotes(); }
        async function moveToTrash(id) { if(confirm('‡∏¢‡πâ‡∏≤‡∏¢‡πÑ‡∏õ‡∏ñ‡∏±‡∏á‡∏Ç‡∏¢‡∏∞?')) { await supabaseClient.from('note').update({ is_deleted: true, is_pinned: false, deleted_at: new Date().toISOString() }).eq('id', id); fetchNotes(); } }
        async function restoreNote(id) { await supabaseClient.from('note').update({ is_deleted: false, deleted_at: null }).eq('id', id); fetchNotes(); }
        async function permanentDelete(id) { if(confirm('‡∏•‡∏ö‡∏ñ‡∏≤‡∏ß‡∏£?')) { await supabaseClient.from('note').delete().eq('id', id); fetchNotes(); } }
        async function togglePin(id, status) { await supabaseClient.from('note').update({ is_pinned: !status }).eq('id', id); fetchNotes(); }
        async function autoCleanTrash() { const limit = new Date(); limit.setDate(limit.getDate() - 7); await supabaseClient.from('note').delete().eq('is_deleted', true).lt('deleted_at', limit.toISOString()); }
        
        function openModal() { document.getElementById('modal').classList.remove('hidden'); document.getElementById('edit-id').value = ''; document.getElementById('title').value = ''; document.getElementById('content').value = ''; }
        function closeModal() { document.getElementById('modal').classList.add('hidden'); }
        function showToast(m) { const t = document.getElementById("toast"); t.innerText = m; t.className = "show"; setTimeout(() => t.className = "", 3000); }
        function editNote(n) { openModal(); document.getElementById('edit-id').value = n.id; document.getElementById('title').value = n.title; document.getElementById('content').value = n.content; const d = n.due_date.split('T'); document.getElementById('date').value = d[0]; document.getElementById('time').value = d[1].substring(0,5); }
    </script>
</body>
</html>



